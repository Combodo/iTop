{# @copyright   Copyright (C) 2010-2021 Combodo SARL #}
{# @license     http://opensource.org/licenses/AGPL-3.0 #}
{% apply spaceless %}

{% UIContentBlock Standard {'aContainerClasses':['ibo-update-core']} %}

    {% UITitle ForPage {'sTitle':'iTopUpdate:UI:PageTitle'|dict_s} %}{% EndUITitle %}

    <div class="ibo-v-spacer">&nbsp;</div>

    {% UIContentBlock Standard {'aContainerClasses': ['display_block', 'display-files']} %}
        {% UIFieldSet Standard {'sLegend':'iTopUpdate:UI:Status'|dict_s} %}
            {% UIAlert ForInformation {'sId':'header-requirements', 'IsCollapsible':false, 'IsClosable':false} %}
                {% UIContentBlock Standard {'aContainerClasses':['ibo-update-core-header-requirements'], 'sId':'can-core-update'} %}
                    {{ 'iTopUpdate:UI:CanCoreUpdate:Loading'|dict_s }}
                    {% UISpinner Standard {} %}
                {% EndUIContentBlock %}
            {% EndUIAlert %}

            {% UIField Standard {'sLabel':'iTopUpdate:UI:CurrentVersion'|dict_s} %}
                {{ 'UI:iTopVersion:Long'|dict_format(constant('ITOP_APPLICATION'), constant('ITOP_VERSION'), constant('ITOP_REVISION'), constant('ITOP_BUILD_DATE')) }}
            {% EndUIField %}

            {% UIField Standard {'sLabel':'iTopUpdate:UI:DiskFreeSpace'|dict_s} %}
                {{ sDiskFreeSpace }}
            {% EndUIField %}

            {% UIField Standard {'sLabel':'iTopUpdate:UI:ItopDiskSpace'|dict_s, 'ValueId':'itop-disk-space'} %}
                {% UISpinner Standard {} %}
            {% EndUIField %}

            {% UIField Standard {'sLabel':'iTopUpdate:UI:DBDiskSpace'|dict_s, 'ValueId':'db-disk-space'} %}
                {% UISpinner Standard {} %}
            {% EndUIField %}

            {% UIField Standard {'sLabel':'iTopUpdate:UI:FileUploadMaxSize'|dict_s} %}
                {{ sFileUploadMaxSize }}
            {% EndUIField %}

        {% EndUIFieldSet %}

        {% UIFieldSet Standard {'sLegend':'iTopUpdate:UI:SelectUpdateFile'|dict_s, 'sId':'form-update-outer'} %}
            {% UIForm Standard {} %}
                {% UIInput ForHidden {'sName':'operation', 'sValue':'ConfirmUpdate'} %}
                {% UIInput ForHidden {'sName':'transaction_id', 'sValue':sTransactionId} %}

                {% UIAlert ForFailure {'sId':'header-file-size', 'IsHidden':true} %}
                    {% UIContentBlock Standard {'aContainerClasses':['ibo-file-size-error']} %}
                        {{ 'iTopUpdate:Error:FileUploadMaxSizeTooSmall'|dict_s }}
                    {% EndUIContentBlock %}
                    {% UIContentBlock Standard {'aContainerClasses':['ibo-file-size-error']} %}
                        {{ 'iTopUpdate:UI:PostMaxSize'|dict_format(sPostMaxSize) }}
                    {% EndUIContentBlock %}
                    {% UIContentBlock Standard {'aContainerClasses':['ibo-file-size-error']} %}
                        {{ 'iTopUpdate:UI:UploadMaxFileSize'|dict_format(sUploadMaxSize) }}
                    {% EndUIContentBlock %}
                {% EndUIAlert %}

                {% UIFileSelect Standard {sName: 'file', sId: 'file'} %}

                {% UIAlert ForWarning {'sId':'dobackup-warning', 'IsHidden':true} %}
                    {{ 'iTopUpdate:UI:DoBackup:Warning'|dict_s }}
                {% EndUIAlert %}

                {% UIContentBlock Standard {'aContainerClasses':['ibo-font-ral-nor-150']} %}
                    {% UIInput Standard {'sType':'checkbox', 'sId':'doBackup', 'sName':'doBackup', 'sValue':'1', 'IsChecked':true, 'CSSClasses':['ibo-input-checkbox', 'ibo-input--label-left']} %}
                    {{ 'iTopUpdate:UI:DoBackup:Label'|dict_s }}
                {% EndUIContentBlock %}

                {% UIContentBlock Standard {'aContainerClasses':['ibo-font-ral-nor-150']} %}
                    {% UIInput Standard {'sType':'checkbox', 'sId':'doFilesArchive', 'sName':'doFilesArchive', 'sValue':'1', 'IsChecked':true, 'CSSClasses':['ibo-input-checkbox', 'ibo-input--label-left']} %}
                    {{ 'iTopUpdate:UI:DoFilesArchive'|dict_s }}
                {% EndUIContentBlock %}

                {% UIContentBlock Standard {'aContainerClasses':['ibo_check_update_submit']} %}
                    {% UIButton ForPrimaryAction {'sLabel':'iTopUpdate:UI:CheckUpdate'|dict_s, 'sId':'check-update', 'bIsSubmit':true, 'IsDisabled':true} %}
                    {% UISpinner Standard {'sId':'submit-wait', 'IsHidden':true} %}
                {% EndUIContentBlock %}

            {% EndUIForm %}

        {% EndUIFieldSet %}

        {% UIFieldSet Standard {'sLegend':'iTopUpdate:UI:History'|dict_s} %}
            {% UIDataTable ForResult {'oPage':oPage, 'sListId':'iboupdatehistory', 'oSet':oSet} %}{% EndUIDataTable %}
        {% EndUIFieldSet %}

    {% EndUIContentBlock %}

{% EndUIContentBlock %}
{% endapply %}