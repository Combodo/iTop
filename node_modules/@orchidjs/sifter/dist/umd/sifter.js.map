{"version":3,"file":"sifter.js","sources":["../../node_modules/@orchidjs/unicode-variants/dist/esm/regex.js","../../node_modules/@orchidjs/unicode-variants/dist/esm/strings.js","../../node_modules/@orchidjs/unicode-variants/dist/esm/index.js","../../lib/utils.ts","../../lib/sifter.ts"],"sourcesContent":["/*! @orchidjs/unicode-variants | https://github.com/orchidjs/unicode-variants | Apache License (v2) */\n/**\n * Convert array of strings to a regular expression\n *\tex ['ab','a'] => (?:ab|a)\n * \tex ['a','b'] => [ab]\n * @param {string[]} chars\n * @return {string}\n */\nconst arrayToPattern = chars => {\n  chars = chars.filter(Boolean);\n\n  if (chars.length < 2) {\n    return chars[0] || '';\n  }\n\n  return maxValueLength(chars) == 1 ? '[' + chars.join('') + ']' : '(?:' + chars.join('|') + ')';\n};\n/**\n * @param {string[]} array\n * @return {string}\n */\n\nconst sequencePattern = array => {\n  if (!hasDuplicates(array)) {\n    return array.join('');\n  }\n\n  let pattern = '';\n  let prev_char_count = 0;\n\n  const prev_pattern = () => {\n    if (prev_char_count > 1) {\n      pattern += '{' + prev_char_count + '}';\n    }\n  };\n\n  array.forEach((char, i) => {\n    if (char === array[i - 1]) {\n      prev_char_count++;\n      return;\n    }\n\n    prev_pattern();\n    pattern += char;\n    prev_char_count = 1;\n  });\n  prev_pattern();\n  return pattern;\n};\n/**\n * Convert array of strings to a regular expression\n *\tex ['ab','a'] => (?:ab|a)\n * \tex ['a','b'] => [ab]\n * @param {Set<string>} chars\n * @return {string}\n */\n\nconst setToPattern = chars => {\n  let array = toArray(chars);\n  return arrayToPattern(array);\n};\n/**\n *\n * https://stackoverflow.com/questions/7376598/in-javascript-how-do-i-check-if-an-array-has-duplicate-values\n * @param {any[]} array\n */\n\nconst hasDuplicates = array => {\n  return new Set(array).size !== array.length;\n};\n/**\n * https://stackoverflow.com/questions/63006601/why-does-u-throw-an-invalid-escape-error\n * @param {string} str\n * @return {string}\n */\n\nconst escape_regex = str => {\n  return (str + '').replace(/([\\$\\(\\)\\*\\+\\.\\?\\[\\]\\^\\{\\|\\}\\\\])/gu, '\\\\$1');\n};\n/**\n * Return the max length of array values\n * @param {string[]} array\n *\n */\n\nconst maxValueLength = array => {\n  return array.reduce((longest, value) => Math.max(longest, unicodeLength(value)), 0);\n};\n/**\n * @param {string} str\n */\n\nconst unicodeLength = str => {\n  return toArray(str).length;\n};\n/**\n * @param {any} p\n * @return {any[]}\n */\n\nconst toArray = p => Array.from(p);\n\nexport { arrayToPattern, escape_regex, hasDuplicates, maxValueLength, sequencePattern, setToPattern, toArray, unicodeLength };\n//# sourceMappingURL=regex.js.map\n","/*! @orchidjs/unicode-variants | https://github.com/orchidjs/unicode-variants | Apache License (v2) */\n/**\n * Get all possible combinations of substrings that add up to the given string\n * https://stackoverflow.com/questions/30169587/find-all-the-combination-of-substrings-that-add-up-to-the-given-string\n * @param {string} input\n * @return {string[][]}\n */\nconst allSubstrings = input => {\n  if (input.length === 1) return [[input]];\n  /** @type {string[][]} */\n\n  let result = [];\n  const start = input.substring(1);\n  const suba = allSubstrings(start);\n  suba.forEach(function (subresult) {\n    let tmp = subresult.slice(0);\n    tmp[0] = input.charAt(0) + tmp[0];\n    result.push(tmp);\n    tmp = subresult.slice(0);\n    tmp.unshift(input.charAt(0));\n    result.push(tmp);\n  });\n  return result;\n};\n\nexport { allSubstrings };\n//# sourceMappingURL=strings.js.map\n","/*! @orchidjs/unicode-variants | https://github.com/orchidjs/unicode-variants | Apache License (v2) */\nimport { toArray, setToPattern, escape_regex, arrayToPattern, sequencePattern } from './regex.js';\nexport { escape_regex } from './regex.js';\nimport { allSubstrings } from './strings.js';\n\n/**\n * @typedef {{[key:string]:string}} TUnicodeMap\n * @typedef {{[key:string]:Set<string>}} TUnicodeSets\n * @typedef {[[number,number]]} TCodePoints\n * @typedef {{folded:string,composed:string,code_point:number}} TCodePointObj\n * @typedef {{start:number,end:number,length:number,substr:string}} TSequencePart\n */\n/** @type {TCodePoints} */\n\nconst code_points = [[0, 65535]];\nconst accent_pat = '[\\u0300-\\u036F\\u{b7}\\u{2be}\\u{2bc}]';\n/** @type {TUnicodeMap} */\n\nlet unicode_map;\n/** @type {RegExp} */\n\nlet multi_char_reg;\nconst max_char_length = 3;\n/** @type {TUnicodeMap} */\n\nconst latin_convert = {};\n/** @type {TUnicodeMap} */\n\nconst latin_condensed = {\n  '/': '⁄∕',\n  '0': '߀',\n  \"a\": \"ⱥɐɑ\",\n  \"aa\": \"ꜳ\",\n  \"ae\": \"æǽǣ\",\n  \"ao\": \"ꜵ\",\n  \"au\": \"ꜷ\",\n  \"av\": \"ꜹꜻ\",\n  \"ay\": \"ꜽ\",\n  \"b\": \"ƀɓƃ\",\n  \"c\": \"ꜿƈȼↄ\",\n  \"d\": \"đɗɖᴅƌꮷԁɦ\",\n  \"e\": \"ɛǝᴇɇ\",\n  \"f\": \"ꝼƒ\",\n  \"g\": \"ǥɠꞡᵹꝿɢ\",\n  \"h\": \"ħⱨⱶɥ\",\n  \"i\": \"ɨı\",\n  \"j\": \"ɉȷ\",\n  \"k\": \"ƙⱪꝁꝃꝅꞣ\",\n  \"l\": \"łƚɫⱡꝉꝇꞁɭ\",\n  \"m\": \"ɱɯϻ\",\n  \"n\": \"ꞥƞɲꞑᴎлԉ\",\n  \"o\": \"øǿɔɵꝋꝍᴑ\",\n  \"oe\": \"œ\",\n  \"oi\": \"ƣ\",\n  \"oo\": \"ꝏ\",\n  \"ou\": \"ȣ\",\n  \"p\": \"ƥᵽꝑꝓꝕρ\",\n  \"q\": \"ꝗꝙɋ\",\n  \"r\": \"ɍɽꝛꞧꞃ\",\n  \"s\": \"ßȿꞩꞅʂ\",\n  \"t\": \"ŧƭʈⱦꞇ\",\n  \"th\": \"þ\",\n  \"tz\": \"ꜩ\",\n  \"u\": \"ʉ\",\n  \"v\": \"ʋꝟʌ\",\n  \"vy\": \"ꝡ\",\n  \"w\": \"ⱳ\",\n  \"y\": \"ƴɏỿ\",\n  \"z\": \"ƶȥɀⱬꝣ\",\n  \"hv\": \"ƕ\"\n};\n\nfor (let latin in latin_condensed) {\n  let unicode = latin_condensed[latin] || '';\n\n  for (let i = 0; i < unicode.length; i++) {\n    let char = unicode.substring(i, i + 1);\n    latin_convert[char] = latin;\n  }\n}\n\nconst convert_pat = new RegExp(Object.keys(latin_convert).join('|') + '|' + accent_pat, 'gu');\n/**\n * Initialize the unicode_map from the give code point ranges\n *\n * @param {TCodePoints=} _code_points\n */\n\nconst initialize = _code_points => {\n  if (unicode_map !== undefined) return;\n  unicode_map = generateMap(_code_points || code_points);\n};\n/**\n * Helper method for normalize a string\n * https://developer.mozilla.org/en-US/docs/Web/JavaScript/Reference/Global_Objects/String/normalize\n * @param {string} str\n * @param {string} form\n */\n\nconst normalize = (str, form = 'NFKD') => str.normalize(form);\n/**\n * Remove accents without reordering string\n * calling str.normalize('NFKD') on \\u{594}\\u{595}\\u{596} becomes \\u{596}\\u{594}\\u{595}\n * via https://github.com/krisk/Fuse/issues/133#issuecomment-318692703\n * @param {string} str\n * @return {string}\n */\n\nconst asciifold = str => {\n  return toArray(str).reduce(\n  /**\n   * @param {string} result\n   * @param {string} char\n   */\n  (result, char) => {\n    return result + _asciifold(char);\n  }, '');\n};\n/**\n * @param {string} str\n * @return {string}\n */\n\nconst _asciifold = str => {\n  str = normalize(str).toLowerCase().replace(convert_pat, (\n  /** @type {string} */\n  char) => {\n    return latin_convert[char] || '';\n  }); //return str;\n\n  return normalize(str, 'NFC');\n};\n/**\n * Generate a list of unicode variants from the list of code points\n * @param {TCodePoints} code_points\n * @yield {TCodePointObj}\n */\n\nfunction* generator(code_points) {\n  for (const [code_point_min, code_point_max] of code_points) {\n    for (let i = code_point_min; i <= code_point_max; i++) {\n      let composed = String.fromCharCode(i);\n      let folded = asciifold(composed);\n\n      if (folded == composed.toLowerCase()) {\n        continue;\n      } // skip when folded is a string longer than 3 characters long\n      // bc the resulting regex patterns will be long\n      // eg:\n      // folded صلى الله عليه وسلم length 18 code point 65018\n      // folded جل جلاله length 8 code point 65019\n\n\n      if (folded.length > max_char_length) {\n        continue;\n      }\n\n      if (folded.length == 0) {\n        continue;\n      }\n\n      yield {\n        folded: folded,\n        composed: composed,\n        code_point: i\n      };\n    }\n  }\n}\n/**\n * Generate a unicode map from the list of code points\n * @param {TCodePoints} code_points\n * @return {TUnicodeSets}\n */\n\nconst generateSets = code_points => {\n  /** @type {{[key:string]:Set<string>}} */\n  const unicode_sets = {};\n  /**\n   * @param {string} folded\n   * @param {string} to_add\n   */\n\n  const addMatching = (folded, to_add) => {\n    /** @type {Set<string>} */\n    const folded_set = unicode_sets[folded] || new Set();\n    const patt = new RegExp('^' + setToPattern(folded_set) + '$', 'iu');\n\n    if (to_add.match(patt)) {\n      return;\n    }\n\n    folded_set.add(escape_regex(to_add));\n    unicode_sets[folded] = folded_set;\n  };\n\n  for (let value of generator(code_points)) {\n    addMatching(value.folded, value.folded);\n    addMatching(value.folded, value.composed);\n  }\n\n  return unicode_sets;\n};\n/**\n * Generate a unicode map from the list of code points\n * ae => (?:(?:ae|Æ|Ǽ|Ǣ)|(?:A|Ⓐ|Ａ...)(?:E|ɛ|Ⓔ...))\n *\n * @param {TCodePoints} code_points\n * @return {TUnicodeMap}\n */\n\nconst generateMap = code_points => {\n  /** @type {TUnicodeSets} */\n  const unicode_sets = generateSets(code_points);\n  /** @type {TUnicodeMap} */\n\n  const unicode_map = {};\n  /** @type {string[]} */\n\n  let multi_char = [];\n\n  for (let folded in unicode_sets) {\n    let set = unicode_sets[folded];\n\n    if (set) {\n      unicode_map[folded] = setToPattern(set);\n    }\n\n    if (folded.length > 1) {\n      multi_char.push(escape_regex(folded));\n    }\n  }\n\n  multi_char.sort((a, b) => b.length - a.length);\n  const multi_char_patt = arrayToPattern(multi_char);\n  multi_char_reg = new RegExp('^' + multi_char_patt, 'u');\n  return unicode_map;\n};\n/**\n * Map each element of an array from it's folded value to all possible unicode matches\n * @param {string[]} strings\n * @param {number} min_replacement\n * @return {string}\n */\n\nconst mapSequence = (strings, min_replacement = 1) => {\n  let chars_replaced = 0;\n  strings = strings.map(str => {\n    if (unicode_map[str]) {\n      chars_replaced += str.length;\n    }\n\n    return unicode_map[str] || str;\n  });\n\n  if (chars_replaced >= min_replacement) {\n    return sequencePattern(strings);\n  }\n\n  return '';\n};\n/**\n * Convert a short string and split it into all possible patterns\n * Keep a pattern only if min_replacement is met\n *\n * 'abc'\n * \t\t=> [['abc'],['ab','c'],['a','bc'],['a','b','c']]\n *\t\t=> ['abc-pattern','ab-c-pattern'...]\n *\n *\n * @param {string} str\n * @param {number} min_replacement\n * @return {string}\n */\n\nconst substringsToPattern = (str, min_replacement = 1) => {\n  min_replacement = Math.max(min_replacement, str.length - 1);\n  return arrayToPattern(allSubstrings(str).map(sub_pat => {\n    return mapSequence(sub_pat, min_replacement);\n  }));\n};\n/**\n * Convert an array of sequences into a pattern\n * [{start:0,end:3,length:3,substr:'iii'}...] => (?:iii...)\n *\n * @param {Sequence[]} sequences\n * @param {boolean} all\n */\n\nconst sequencesToPattern = (sequences, all = true) => {\n  let min_replacement = sequences.length > 1 ? 1 : 0;\n  return arrayToPattern(sequences.map(sequence => {\n    let seq = [];\n    const len = all ? sequence.length() : sequence.length() - 1;\n\n    for (let j = 0; j < len; j++) {\n      seq.push(substringsToPattern(sequence.substrs[j] || '', min_replacement));\n    }\n\n    return sequencePattern(seq);\n  }));\n};\n/**\n * Return true if the sequence is already in the sequences\n * @param {Sequence} needle_seq\n * @param {Sequence[]} sequences\n */\n\n\nconst inSequences = (needle_seq, sequences) => {\n  for (const seq of sequences) {\n    if (seq.start != needle_seq.start || seq.end != needle_seq.end) {\n      continue;\n    }\n\n    if (seq.substrs.join('') !== needle_seq.substrs.join('')) {\n      continue;\n    }\n\n    let needle_parts = needle_seq.parts;\n    /**\n     * @param {TSequencePart} part\n     */\n\n    const filter = part => {\n      for (const needle_part of needle_parts) {\n        if (needle_part.start === part.start && needle_part.substr === part.substr) {\n          return false;\n        }\n\n        if (part.length == 1 || needle_part.length == 1) {\n          continue;\n        } // check for overlapping parts\n        // a = ['::=','==']\n        // b = ['::','===']\n        // a = ['r','sm']\n        // b = ['rs','m']\n\n\n        if (part.start < needle_part.start && part.end > needle_part.start) {\n          return true;\n        }\n\n        if (needle_part.start < part.start && needle_part.end > part.start) {\n          return true;\n        }\n      }\n\n      return false;\n    };\n\n    let filtered = seq.parts.filter(filter);\n\n    if (filtered.length > 0) {\n      continue;\n    }\n\n    return true;\n  }\n\n  return false;\n};\n\nclass Sequence {\n  constructor() {\n    /** @type {TSequencePart[]} */\n    this.parts = [];\n    /** @type {string[]} */\n\n    this.substrs = [];\n    this.start = 0;\n    this.end = 0;\n  }\n  /**\n   * @param {TSequencePart|undefined} part\n   */\n\n\n  add(part) {\n    if (part) {\n      this.parts.push(part);\n      this.substrs.push(part.substr);\n      this.start = Math.min(part.start, this.start);\n      this.end = Math.max(part.end, this.end);\n    }\n  }\n\n  last() {\n    return this.parts[this.parts.length - 1];\n  }\n\n  length() {\n    return this.parts.length;\n  }\n  /**\n   * @param {number} position\n   * @param {TSequencePart} last_piece\n   */\n\n\n  clone(position, last_piece) {\n    let clone = new Sequence();\n    let parts = JSON.parse(JSON.stringify(this.parts));\n    let last_part = parts.pop();\n\n    for (const part of parts) {\n      clone.add(part);\n    }\n\n    let last_substr = last_piece.substr.substring(0, position - last_part.start);\n    let clone_last_len = last_substr.length;\n    clone.add({\n      start: last_part.start,\n      end: last_part.start + clone_last_len,\n      length: clone_last_len,\n      substr: last_substr\n    });\n    return clone;\n  }\n\n}\n/**\n * Expand a regular expression pattern to include unicode variants\n * \teg /a/ becomes /aⓐａẚàáâầấẫẩãāăằắẵẳȧǡäǟảåǻǎȁȃạậặḁąⱥɐɑAⒶＡÀÁÂẦẤẪẨÃĀĂẰẮẴẲȦǠÄǞẢÅǺǍȀȂẠẬẶḀĄȺⱯ/\n *\n * Issue:\n *  ﺊﺋ [ 'ﺊ = \\\\u{fe8a}', 'ﺋ = \\\\u{fe8b}' ]\n *\tbecomes:\tئئ [ 'ي = \\\\u{64a}', 'ٔ = \\\\u{654}', 'ي = \\\\u{64a}', 'ٔ = \\\\u{654}' ]\n *\n *\tİĲ = IIJ = ⅡJ\n *\n * \t1/2/4\n *\n * @param {string} str\n * @return {string|undefined}\n */\n\n\nconst getPattern = str => {\n  initialize();\n  str = asciifold(str);\n  let pattern = '';\n  let sequences = [new Sequence()];\n\n  for (let i = 0; i < str.length; i++) {\n    let substr = str.substring(i);\n    let match = substr.match(multi_char_reg);\n    const char = str.substring(i, i + 1);\n    const match_str = match ? match[0] : null; // loop through sequences\n    // add either the char or multi_match\n\n    let overlapping = [];\n    let added_types = new Set();\n\n    for (const sequence of sequences) {\n      const last_piece = sequence.last();\n\n      if (!last_piece || last_piece.length == 1 || last_piece.end <= i) {\n        // if we have a multi match\n        if (match_str) {\n          const len = match_str.length;\n          sequence.add({\n            start: i,\n            end: i + len,\n            length: len,\n            substr: match_str\n          });\n          added_types.add('1');\n        } else {\n          sequence.add({\n            start: i,\n            end: i + 1,\n            length: 1,\n            substr: char\n          });\n          added_types.add('2');\n        }\n      } else if (match_str) {\n        let clone = sequence.clone(i, last_piece);\n        const len = match_str.length;\n        clone.add({\n          start: i,\n          end: i + len,\n          length: len,\n          substr: match_str\n        });\n        overlapping.push(clone);\n      } else {\n        // don't add char\n        // adding would create invalid patterns: 234 => [2,34,4]\n        added_types.add('3');\n      }\n    } // if we have overlapping\n\n\n    if (overlapping.length > 0) {\n      // ['ii','iii'] before ['i','i','iii']\n      overlapping = overlapping.sort((a, b) => {\n        return a.length() - b.length();\n      });\n\n      for (let clone of overlapping) {\n        // don't add if we already have an equivalent sequence\n        if (inSequences(clone, sequences)) {\n          continue;\n        }\n\n        sequences.push(clone);\n      }\n\n      continue;\n    } // if we haven't done anything unique\n    // clean up the patterns\n    // helps keep patterns smaller\n    // if str = 'r₨㎧aarss', pattern will be 446 instead of 655\n\n\n    if (i > 0 && added_types.size == 1 && !added_types.has('3')) {\n      pattern += sequencesToPattern(sequences, false);\n      let new_seq = new Sequence();\n      const old_seq = sequences[0];\n\n      if (old_seq) {\n        new_seq.add(old_seq.last());\n      }\n\n      sequences = [new_seq];\n    }\n  }\n\n  pattern += sequencesToPattern(sequences, true);\n  return pattern;\n};\n\nexport { _asciifold, asciifold, code_points, generateMap, generateSets, generator, getPattern, initialize, mapSequence, normalize, substringsToPattern, unicode_map };\n//# sourceMappingURL=index.js.map\n","\nimport { asciifold } from '@orchidjs/unicode-variants';\nimport * as T from './types';\n\n\n/**\n * A property getter resolving dot-notation\n * @param  {Object}  obj     The root object to fetch property on\n * @param  {String}  name    The optionally dotted property name to fetch\n * @return {Object}          The resolved property value\n */\nexport const getAttr = (obj:{[key:string]:any}, name:string ) => {\n    if (!obj ) return;\n    return obj[name];\n};\n\n/**\n * A property getter resolving dot-notation\n * @param  {Object}  obj     The root object to fetch property on\n * @param  {String}  name    The optionally dotted property name to fetch\n * @return {Object}          The resolved property value\n */\nexport const getAttrNesting = (obj:{[key:string]:any}, name:string ) => {\n    if (!obj ) return;\n    var part, names = name.split(\".\");\n\twhile( (part = names.shift()) && (obj = obj[part]));\n    return obj;\n};\n\n/**\n * Calculates how close of a match the\n * given value is against a search token.\n *\n */\nexport const scoreValue = (value:string, token:T.Token, weight:number ):number => {\n\tvar score, pos;\n\n\tif (!value) return 0;\n\n\tvalue = value + '';\n\tif( token.regex == null ) return 0;\n\tpos = value.search(token.regex);\n\tif (pos === -1) return 0;\n\n\tscore = token.string.length / value.length;\n\tif (pos === 0) score += 0.5;\n\n\treturn score * weight;\n};\n\n\n/**\n * Cast object property to an array if it exists and has a value\n *\n */\nexport const propToArray = (obj:{[key:string]:any}, key:string) => {\n\tvar value = obj[key];\n\n\tif( typeof value == 'function' ) return value;\n\n\tif( value && !Array.isArray(value) ){\n\t\tobj[key] = [value];\n\t}\n}\n\n\n/**\n * Iterates over arrays and hashes.\n *\n * ```\n * iterate(this.items, function(item, id) {\n *    // invoked for each item\n * });\n * ```\n *\n */\nexport const iterate = (object:[]|{[key:string]:any}, callback:(value:any,key:any)=>any) => {\n\n\tif ( Array.isArray(object)) {\n\t\tobject.forEach(callback);\n\n\t}else{\n\n\t\tfor (var key in object) {\n\t\t\tif (object.hasOwnProperty(key)) {\n\t\t\t\tcallback(object[key], key);\n\t\t\t}\n\t\t}\n\t}\n};\n\n\n\nexport const cmp = (a:number|string, b:number|string) => {\n\tif (typeof a === 'number' && typeof b === 'number') {\n\t\treturn a > b ? 1 : (a < b ? -1 : 0);\n\t}\n\ta = asciifold(a + '').toLowerCase();\n\tb = asciifold(b + '').toLowerCase();\n\tif (a > b) return 1;\n\tif (b > a) return -1;\n\treturn 0;\n};\n","/**\n * sifter.js\n * Copyright (c) 2013–2020 Brian Reavis & contributors\n *\n * Licensed under the Apache License, Version 2.0 (the \"License\"); you may not use this\n * file except in compliance with the License. You may obtain a copy of the License at:\n * http://www.apache.org/licenses/LICENSE-2.0\n *\n * Unless required by applicable law or agreed to in writing, software distributed under\n * the License is distributed on an \"AS IS\" BASIS, WITHOUT WARRANTIES OR CONDITIONS OF\n * ANY KIND, either express or implied. See the License for the specific language\n * governing permissions and limitations under the License.\n *\n * @author Brian Reavis <brian@thirdroute.com>\n */\n\nimport { scoreValue, getAttr, getAttrNesting, propToArray, iterate, cmp } from './utils';\nimport { getPattern, escape_regex } from '@orchidjs/unicode-variants';\nimport * as T from './types';\n\nclass Sifter{\n\n\tpublic items: any; // []|{};\n\tpublic settings: T.Settings;\n\n\t/**\n\t * Textually searches arrays and hashes of objects\n\t * by property (or multiple properties). Designed\n\t * specifically for autocomplete.\n\t *\n\t */\n\tconstructor(items:any, settings:T.Settings) {\n\t\tthis.items = items;\n\t\tthis.settings = settings || {diacritics: true};\n\t};\n\n\t/**\n\t * Splits a search string into an array of individual\n\t * regexps to be used to match results.\n\t *\n\t */\n\ttokenize(query:string, respect_word_boundaries?:boolean, weights?:T.Weights ):T.Token[] {\n\t\tif (!query || !query.length) return [];\n\n\t\tconst tokens:T.Token[]\t= [];\n\t\tconst words\t\t\t\t= query.split(/\\s+/);\n\t\tvar field_regex:RegExp;\n\n\t\tif( weights ){\n\t\t\tfield_regex = new RegExp( '^('+ Object.keys(weights).map(escape_regex).join('|')+')\\:(.*)$');\n\t\t}\n\n\t\twords.forEach((word:string) => {\n\t\t\tlet field_match;\n\t\t\tlet field:null|string\t= null;\n\t\t\tlet regex:null|string\t= null;\n\n\t\t\t// look for \"field:query\" tokens\n\t\t\tif( field_regex && (field_match = word.match(field_regex)) ){\n\t\t\t\tfield\t= field_match[1]!;\n\t\t\t\tword\t= field_match[2]!;\n\t\t\t}\n\n\t\t\tif( word.length > 0 ){\n\t\t\t\tif( this.settings.diacritics ){\n\t\t\t\t\tregex = getPattern(word) || null;\n\t\t\t\t}else{\n\t\t\t\t\tregex = escape_regex(word);\n\t\t\t\t}\n\t\t\t\tif( regex && respect_word_boundaries ) regex = \"\\\\b\"+regex;\n\t\t\t}\n\n\t\t\ttokens.push({\n\t\t\t\tstring : word,\n\t\t\t\tregex  : regex ? new RegExp(regex,'iu') : null,\n\t\t\t\tfield  : field,\n\t\t\t});\n\t\t});\n\n\t\treturn tokens;\n\t};\n\n\n\t/**\n\t * Returns a function to be used to score individual results.\n\t *\n\t * Good matches will have a higher score than poor matches.\n\t * If an item is not a match, 0 will be returned by the function.\n\t *\n\t * @returns {T.ScoreFn}\n\t */\n\tgetScoreFunction(query:string, options:T.UserOptions ){\n\t\tvar search = this.prepareSearch(query, options);\n\t\treturn this._getScoreFunction(search);\n\t}\n\n\t/**\n\t * @returns {T.ScoreFn}\n\t *\n\t */\n\t_getScoreFunction(search:T.PrepareObj ){\n\t\tconst tokens\t\t= search.tokens,\n\t\ttoken_count\t\t\t= tokens.length;\n\n\t\tif (!token_count) {\n\t\t\treturn function() { return 0; };\n\t\t}\n\n\t\tconst fields\t= search.options.fields,\n\t\tweights\t\t\t= search.weights,\n\t\tfield_count\t\t= fields.length,\n\t\tgetAttrFn\t\t= search.getAttrFn;\n\n\t\tif (!field_count) {\n\t\t\treturn function() { return 1; };\n\t\t}\n\n\n\t\t/**\n\t\t * Calculates the score of an object\n\t\t * against the search query.\n\t\t *\n\t\t */\n\t\tconst scoreObject = (function() {\n\n\n\t\t\tif (field_count === 1) {\n\t\t\t\treturn function(token:T.Token, data:{}) {\n\t\t\t\t\tconst field = fields[0]!.field;\n\t\t\t\t\treturn scoreValue(getAttrFn(data, field), token, weights[field]||1);\n\t\t\t\t};\n\t\t\t}\n\n\t\t\treturn function(token:T.Token, data:{}) {\n\t\t\t\tvar sum = 0;\n\n\t\t\t\t// is the token specific to a field?\n\t\t\t\tif( token.field ){\n\n\t\t\t\t\tconst value = getAttrFn(data, token.field);\n\n\t\t\t\t\tif( !token.regex && value ){\n\t\t\t\t\t\tsum += (1/field_count);\n\t\t\t\t\t}else{\n\t\t\t\t\t\tsum += scoreValue(value, token, 1);\n\t\t\t\t\t}\n\n\n\n\t\t\t\t}else{\n\t\t\t\t\titerate(weights, (weight:number, field:string) => {\n\t\t\t\t\t\tsum += scoreValue(getAttrFn(data, field), token, weight);\n\t\t\t\t\t});\n\t\t\t\t}\n\n\t\t\t\treturn sum / field_count;\n\t\t\t};\n\t\t})();\n\n\t\tif (token_count === 1) {\n\t\t\treturn function(data:{}) {\n\t\t\t\treturn scoreObject(tokens[0]!, data);\n\t\t\t};\n\t\t}\n\n\t\tif (search.options.conjunction === 'and') {\n\t\t\treturn function(data:{}) {\n\t\t\t\tvar score, sum = 0;\n\t\t\t\tfor( let token of tokens){\n\t\t\t\t\tscore = scoreObject(token, data);\n\t\t\t\t\tif (score <= 0) return 0;\n\t\t\t\t\tsum += score;\n\t\t\t\t}\n\t\t\t\treturn sum / token_count;\n\t\t\t};\n\t\t} else {\n\t\t\treturn function(data:{}) {\n\t\t\t\tvar sum = 0;\n\t\t\t\titerate(tokens,(token:T.Token)=>{\n\t\t\t\t\tsum += scoreObject(token, data);\n\t\t\t\t});\n\t\t\t\treturn sum / token_count;\n\t\t\t};\n\t\t}\n\t};\n\n\t/**\n\t * Returns a function that can be used to compare two\n\t * results, for sorting purposes. If no sorting should\n\t * be performed, `null` will be returned.\n\t *\n\t * @return function(a,b)\n\t */\n\tgetSortFunction(query:string, options:T.UserOptions) {\n\t\tvar search  = this.prepareSearch(query, options);\n\t\treturn this._getSortFunction(search);\n\t}\n\n\t_getSortFunction(search:T.PrepareObj){\n\t\tvar implicit_score,\n\t\tsort_flds:T.Sort[]\t= [];\n\n\t\tconst self\t= this,\n\t\toptions\t\t= search.options,\n\t\tsort\t\t= (!search.query && options.sort_empty) ? options.sort_empty : options.sort;\n\n\n\t\tif( typeof sort == 'function' ){\n\t\t\treturn sort.bind(this);\n\t\t}\n\n\t\t/**\n\t\t * Fetches the specified sort field value\n\t\t * from a search result item.\n\t\t *\n\t\t */\n\t\tconst get_field = function(name:string, result:T.ResultItem):string|number {\n\t\t\tif (name === '$score') return result.score;\n\t\t\treturn search.getAttrFn(self.items[result.id], name);\n\t\t};\n\n\t\t// parse options\n\t\tif (sort) {\n\t\t\tfor( let s of sort ){\n\t\t\t\tif (search.query || s.field !== '$score') {\n\t\t\t\t\tsort_flds.push(s);\n\t\t\t\t}\n\t\t\t}\n\t\t}\n\n\t\t// the \"$score\" field is implied to be the primary\n\t\t// sort field, unless it's manually specified\n\t\tif (search.query) {\n\t\t\timplicit_score = true;\n\t\t\tfor( let fld of sort_flds ){\n\t\t\t\tif( fld.field === '$score' ){\n\t\t\t\t\timplicit_score = false;\n\t\t\t\t\tbreak;\n\t\t\t\t}\n\t\t\t}\n\t\t\tif (implicit_score) {\n\t\t\t\tsort_flds.unshift({field: '$score', direction: 'desc'});\n\t\t\t}\n\n\t\t// without a search.query, all items will have the same score\n\t\t} else {\n\t\t\tsort_flds = sort_flds.filter((fld) => fld.field !== '$score' );\n\t\t}\n\n\n\t\t// build function\n\t\tconst sort_flds_count = sort_flds.length;\n\t\tif (!sort_flds_count) {\n\t\t\treturn null;\n\t\t}\n\n\t\treturn function(a:T.ResultItem, b:T.ResultItem) {\n\t\t\tvar result, field;\n\t\t\tfor( let sort_fld of sort_flds ){\n\t\t\t\tfield = sort_fld.field;\n\n\t\t\t\tlet\tmultiplier = sort_fld.direction === 'desc' ? -1 : 1;\n\n\t\t\t\tresult = multiplier * cmp(\n\t\t\t\t\tget_field(field, a),\n\t\t\t\t\tget_field(field, b)\n\t\t\t\t);\n\t\t\t\tif (result) return result;\n\t\t\t}\n\t\t\treturn 0;\n\t\t};\n\n\t};\n\n\t/**\n\t * Parses a search query and returns an object\n\t * with tokens and fields ready to be populated\n\t * with results.\n\t *\n\t */\n\tprepareSearch(query:string, optsUser:T.UserOptions):T.PrepareObj {\n\t\tconst weights:T.Weights = {};\n\t\tvar options\t\t= Object.assign({},optsUser) as T.Options;\n\n\t\tpropToArray(options,'sort');\n\t\tpropToArray(options,'sort_empty');\n\n\t\t// convert fields to new format\n\t\tif( options.fields ){\n\t\t\tpropToArray(options,'fields');\n\t\t\tconst fields:T.Field[] = [];\n\t\t\toptions.fields.forEach((field:string|T.Field) => {\n\t\t\t\tif( typeof field == 'string' ){\n\t\t\t\t\tfield = {field:field,weight:1};\n\t\t\t\t}\n\t\t\t\tfields.push(field);\n\t\t\t\tweights[field.field] = ('weight' in field) ? field.weight : 1;\n\t\t\t});\n\t\t\toptions.fields = fields;\n\t\t}\n\n\n\t\treturn {\n\t\t\toptions\t\t: options as T.Options,\n\t\t\tquery\t\t: query.toLowerCase().trim(),\n\t\t\ttokens\t\t: this.tokenize(query, options.respect_word_boundaries, weights),\n\t\t\ttotal\t\t: 0,\n\t\t\titems\t\t: [],\n\t\t\tweights\t\t: weights,\n\t\t\tgetAttrFn\t: (options.nesting) ? getAttrNesting : getAttr,\n\t\t};\n\t};\n\n\t/**\n\t * Searches through all items and returns a sorted array of matches.\n\t *\n\t */\n\tsearch(query:string, options:T.UserOptions) : T.PrepareObj {\n\t\tvar self = this, score, search: T.PrepareObj;\n\n\t\tsearch  = this.prepareSearch(query, options);\n\t\toptions = search.options;\n\t\tquery   = search.query;\n\n\t\t// generate result scoring function\n\t\tconst fn_score:T.ScoreFn = options.score || self._getScoreFunction(search);\n\n\t\t// perform search and sort\n\t\tif (query.length) {\n\t\t\titerate(self.items, (item:T.ResultItem, id:string|number) => {\n\t\t\t\tscore = fn_score(item);\n\t\t\t\tif (options.filter === false || score > 0) {\n\t\t\t\t\tsearch.items.push({'score': score, 'id': id});\n\t\t\t\t}\n\t\t\t});\n\t\t} else {\n\t\t\titerate(self.items, (_:T.ResultItem, id:string|number) => {\n\t\t\t\tsearch.items.push({'score': 1, 'id': id});\n\t\t\t});\n\t\t}\n\n\t\tconst fn_sort = self._getSortFunction(search);\n\t\tif (fn_sort) search.items.sort(fn_sort);\n\n\t\t// apply limits\n\t\tsearch.total = search.items.length;\n\t\tif (typeof options.limit === 'number') {\n\t\t\tsearch.items = search.items.slice(0, options.limit);\n\t\t}\n\n\t\treturn search;\n\t};\n}\n\nexport { Sifter, scoreValue, getAttr, getAttrNesting, propToArray, iterate, cmp, getPattern }\n"],"names":["arrayToPattern","chars","maxValueLength","sequencePattern","array","hasDuplicates","pattern","prev_char_count","prev_pattern","char","i","setToPattern","toArray","escape_regex","str","Math","unicodeLength","p","Array","allSubstrings","input","result","start","suba","tmp","subresult","code_points","accent_pat","max_char_length","latin_convert","latin_condensed","unicode","convert_pat","Object","initialize","_code_points","unicode_map","generateMap","normalize","form","asciifold","_asciifold","composed","String","folded","code_point","generateSets","unicode_sets","addMatching","folded_set","patt","to_add","generator","value","multi_char","set","b","a","multi_char_patt","multi_char_reg","mapSequence","min_replacement","chars_replaced","strings","substringsToPattern","sub_pat","sequencesToPattern","all","sequences","sequence","seq","len","j","inSequences","needle_seq","needle_parts","filter","part","needle_part","filtered","constructor","add","last","length","clone","parts","JSON","last_part","last_substr","last_piece","position","clone_last_len","end","substr","getPattern","match","match_str","overlapping","added_types","new_seq","old_seq","getAttr","obj","name","getAttrNesting","names","split","shift","scoreValue","token","weight","score","pos","regex","search","string","propToArray","key","isArray","iterate","object","callback","forEach","hasOwnProperty","cmp","toLowerCase","Sifter","items","settings","diacritics","tokenize","query","respect_word_boundaries","weights","tokens","words","field_regex","RegExp","keys","map","join","word","field_match","field","push","getScoreFunction","options","prepareSearch","_getScoreFunction","token_count","fields","field_count","getAttrFn","scoreObject","data","sum","conjunction","getSortFunction","_getSortFunction","implicit_score","sort_flds","self","sort","sort_empty","bind","get_field","id","s","fld","unshift","direction","sort_flds_count","sort_fld","multiplier","optsUser","assign","trim","total","nesting","fn_score","item","_","fn_sort","limit","slice"],"mappings":"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"}